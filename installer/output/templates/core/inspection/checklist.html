{% extends 'base.html' %}
{% block title %}Checklist Conformité{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h4 mb-0"><i class="bi bi-list-check"></i> Checklist de Conformité</h1>
    <a href="{% url 'core:inspection_dashboard' %}" class="btn btn-outline-secondary btn-sm">Retour</a>
</div>

<div class="alert {% if score >= 80 %}alert-success{% elif score >= 50 %}alert-warning{% else %}alert-danger{% endif %}">
    <div class="d-flex justify-content-between align-items-center">
        <span><strong>Score de conformité :</strong> {{ items_conformes }}/{{ total_items }} éléments</span>
        <span class="fs-4"><strong>{{ score }}%</strong></span>
    </div>
    <div class="progress mt-2" style="height: 20px;">
        <div class="progress-bar bg-{% if score >= 80 %}success{% elif score >= 50 %}warning{% else %}danger{% endif %}" style="width: {{ score }}%"></div>
    </div>
</div>

{% for cat in checklist %}
<div class="card shadow mb-4">
    <div class="card-header"><strong>{{ cat.categorie }}</strong></div>
    <div class="card-body">
        <table class="table table-sm mb-0">
            {% for item in cat.items %}
            <tr>
                <td style="width: 40px;">
                    {% if item.conforme %}
                    <i class="bi bi-check-circle-fill text-success fs-5"></i>
                    {% else %}
                    <i class="bi bi-x-circle-fill text-danger fs-5"></i>
                    {% endif %}
                </td>
                <td>
                    {{ item.libelle }}
                    {% if item.obligatoire %}<span class="badge bg-primary">Obligatoire</span>{% endif %}
                </td>
                <td class="text-end">
                    {% if item.conforme %}
                    <span class="text-success">Conforme</span>
                    {% else %}
                    <span class="text-danger">À régulariser</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>
{% endfor %}

<div class="text-end">
    <a href="{% url 'core:generer_rapport' %}" class="btn btn-primary"><i class="bi bi-file-earmark-pdf"></i> Générer rapport</a>
</div>
{% endblock %}
