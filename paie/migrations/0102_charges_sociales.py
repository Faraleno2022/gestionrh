# Generated by Django 5.2.7 on 2026-01-29 16:48

import django.core.validators
import django.db.models.deletion
import uuid
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0011_add_expatrie_fields'),
        ('employes', '0015_add_conjoint_et_docs'),
        ('paie', '0101_auto_20260128_1247'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='AffiliationSecuriteSociale',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('numero_cnss', models.CharField(max_length=50, unique=True)),
                ('date_immatriculation', models.DateField()),
                ('date_affiliation_entreprise', models.DateField()),
                ('date_radiation', models.DateField(blank=True, null=True)),
                ('statut', models.CharField(choices=[('en_cours', "En cours d'immatriculation"), ('active', 'Active'), ('suspendue', 'Suspendue'), ('radiee', 'Radiée')], default='active', max_length=15)),
                ('carte_cnss', models.FileField(blank=True, null=True, upload_to='paie/cartes_cnss/')),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('employe', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='affiliation_cnss', to='employes.employe')),
            ],
            options={
                'verbose_name': 'Affiliation sécurité sociale',
                'verbose_name_plural': 'Affiliations sécurité sociale',
                'db_table': 'paie_affiliation_securite_sociale',
            },
        ),
        migrations.CreateModel(
            name='BilanPaie',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_bilan', models.CharField(choices=[('mensuel', 'Bilan mensuel'), ('trimestriel', 'Bilan trimestriel'), ('annuel', 'Bilan annuel')], max_length=15)),
                ('annee', models.IntegerField()),
                ('mois', models.IntegerField(blank=True, null=True)),
                ('trimestre', models.IntegerField(blank=True, null=True)),
                ('effectif_moyen', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=8)),
                ('entrees', models.IntegerField(default=0)),
                ('sorties', models.IntegerField(default=0)),
                ('masse_salariale_brute', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('masse_salariale_nette', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('cotisations_salariales', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('cotisations_patronales', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('rts_total', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('cout_total_employeur', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('masse_salariale_n1', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True)),
                ('evolution_pourcentage', models.DecimalField(blank=True, decimal_places=2, max_digits=8, null=True)),
                ('fichier_bilan', models.FileField(blank=True, null=True, upload_to='paie/bilans/')),
                ('date_generation', models.DateTimeField(auto_now_add=True)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='bilans_paie', to='core.entreprise')),
                ('genere_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Bilan de paie',
                'verbose_name_plural': 'Bilans de paie',
                'db_table': 'paie_bilan',
                'ordering': ['-annee', '-mois'],
            },
        ),
        migrations.CreateModel(
            name='CotisationSociale',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('code', models.CharField(max_length=20)),
                ('libelle', models.CharField(max_length=200)),
                ('type_cotisation', models.CharField(choices=[('cnss_salarie', 'CNSS Salarié'), ('cnss_employeur', 'CNSS Employeur'), ('vf', 'Versement Forfaitaire'), ('ta', "Taxe d'Apprentissage"), ('onfpp', 'Contribution ONFPP'), ('mutuelle_salarie', 'Mutuelle Salarié'), ('mutuelle_employeur', 'Mutuelle Employeur'), ('retraite_salarie', 'Retraite Complémentaire Salarié'), ('retraite_employeur', 'Retraite Complémentaire Employeur'), ('prevoyance', 'Prévoyance'), ('autre', 'Autre')], max_length=20)),
                ('base_calcul', models.CharField(choices=[('brut', 'Salaire brut'), ('brut_plafonne', 'Salaire brut plafonné'), ('base_cnss', 'Base CNSS'), ('net_imposable', 'Net imposable'), ('forfait', 'Montant forfaitaire')], default='brut', max_length=20)),
                ('taux', models.DecimalField(decimal_places=4, default=Decimal('0.00'), help_text='Taux en pourcentage', max_digits=8)),
                ('montant_forfaitaire', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True)),
                ('plancher', models.DecimalField(blank=True, decimal_places=2, help_text='Plancher de cotisation (SMIG)', max_digits=15, null=True)),
                ('plafond', models.DecimalField(blank=True, decimal_places=2, help_text='Plafond de cotisation', max_digits=15, null=True)),
                ('est_part_salariale', models.BooleanField(default=False)),
                ('est_part_patronale', models.BooleanField(default=False)),
                ('date_debut', models.DateField()),
                ('date_fin', models.DateField(blank=True, null=True)),
                ('est_active', models.BooleanField(default=True)),
                ('organisme', models.CharField(blank=True, max_length=100, null=True)),
                ('entreprise', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='cotisations_sociales', to='core.entreprise')),
            ],
            options={
                'verbose_name': 'Cotisation sociale',
                'verbose_name_plural': 'Cotisations sociales',
                'db_table': 'paie_cotisation_sociale',
                'ordering': ['code'],
            },
        ),
        migrations.CreateModel(
            name='DeclarationCNSS',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('reference', models.CharField(max_length=50)),
                ('type_declaration', models.CharField(choices=[('mensuelle', 'Déclaration mensuelle'), ('trimestrielle', 'Déclaration trimestrielle'), ('annuelle', 'Déclaration annuelle'), ('rectificative', 'Déclaration rectificative')], default='mensuelle', max_length=20)),
                ('annee', models.IntegerField()),
                ('mois', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(12)])),
                ('trimestre', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(4)])),
                ('effectif_total', models.IntegerField(default=0)),
                ('effectif_declare', models.IntegerField(default=0)),
                ('masse_salariale_brute', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('masse_salariale_plafonnee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('cotisation_salariale', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='5% part salariale', max_digits=15)),
                ('cotisation_patronale', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='18% part patronale', max_digits=15)),
                ('total_cotisations', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('penalites_retard', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('majorations', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('montant_a_payer', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('date_limite', models.DateField()),
                ('date_depot', models.DateField(blank=True, null=True)),
                ('date_paiement', models.DateField(blank=True, null=True)),
                ('statut', models.CharField(choices=[('brouillon', 'Brouillon'), ('calcule', 'Calculé'), ('valide', 'Validé'), ('depose', 'Déposé'), ('paye', 'Payé')], default='brouillon', max_length=20)),
                ('date_validation', models.DateTimeField(blank=True, null=True)),
                ('fichier_declaration', models.FileField(blank=True, null=True, upload_to='paie/declarations_cnss/')),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('cree_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='declarations_cnss', to='core.entreprise')),
                ('valide_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='declarations_cnss_validees', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Déclaration CNSS',
                'verbose_name_plural': 'Déclarations CNSS',
                'db_table': 'paie_declaration_cnss',
                'ordering': ['-annee', '-mois'],
            },
        ),
        migrations.CreateModel(
            name='LigneCNSS',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('numero_cnss', models.CharField(blank=True, max_length=50, null=True)),
                ('salaire_brut', models.DecimalField(decimal_places=2, max_digits=15)),
                ('salaire_plafonne', models.DecimalField(decimal_places=2, max_digits=15)),
                ('cotisation_salariale', models.DecimalField(decimal_places=2, max_digits=15)),
                ('cotisation_patronale', models.DecimalField(decimal_places=2, max_digits=15)),
                ('jours_travailles', models.IntegerField(default=0)),
                ('declaration', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lignes', to='paie.declarationcnss')),
                ('employe', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lignes_cnss', to='employes.employe')),
            ],
            options={
                'verbose_name': 'Ligne CNSS',
                'verbose_name_plural': 'Lignes CNSS',
                'db_table': 'paie_ligne_cnss',
            },
        ),
        migrations.CreateModel(
            name='MutuelleEntreprise',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('code', models.CharField(max_length=20)),
                ('nom', models.CharField(max_length=200)),
                ('organisme', models.CharField(max_length=200)),
                ('numero_contrat', models.CharField(max_length=50)),
                ('type_couverture', models.CharField(choices=[('base', 'Couverture de base'), ('etendue', 'Couverture étendue'), ('famille', 'Couverture famille'), ('premium', 'Couverture premium')], max_length=15)),
                ('cotisation_salarie', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('cotisation_employeur', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('cotisation_conjoint', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('cotisation_enfant', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('date_debut', models.DateField()),
                ('date_fin', models.DateField(blank=True, null=True)),
                ('est_active', models.BooleanField(default=True)),
                ('contact_nom', models.CharField(blank=True, max_length=100, null=True)),
                ('contact_telephone', models.CharField(blank=True, max_length=20, null=True)),
                ('contact_email', models.EmailField(blank=True, max_length=254, null=True)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='mutuelles', to='core.entreprise')),
            ],
            options={
                'verbose_name': 'Mutuelle entreprise',
                'verbose_name_plural': 'Mutuelles entreprise',
                'db_table': 'paie_mutuelle',
            },
        ),
        migrations.CreateModel(
            name='RetraiteComplementaire',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('code', models.CharField(max_length=20)),
                ('nom', models.CharField(max_length=200)),
                ('organisme', models.CharField(max_length=200)),
                ('numero_contrat', models.CharField(max_length=50)),
                ('taux_salarie', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=6)),
                ('taux_employeur', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=6)),
                ('plafond', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True)),
                ('date_debut', models.DateField()),
                ('date_fin', models.DateField(blank=True, null=True)),
                ('est_active', models.BooleanField(default=True)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='retraites_complementaires', to='core.entreprise')),
            ],
            options={
                'verbose_name': 'Retraite complémentaire',
                'verbose_name_plural': 'Retraites complémentaires',
                'db_table': 'paie_retraite_complementaire',
            },
        ),
        migrations.CreateModel(
            name='DossierPaie',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('annee', models.IntegerField()),
                ('mois', models.IntegerField(validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(12)])),
                ('effectif_total', models.IntegerField(default=0)),
                ('effectif_paye', models.IntegerField(default=0)),
                ('masse_salariale_brute', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_cotisations_salariales', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_cotisations_patronales', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_rts', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_net_a_payer', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_cnss_employeur', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_vf', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_ta', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('statut', models.CharField(choices=[('ouvert', 'Ouvert'), ('en_calcul', 'En calcul'), ('calcule', 'Calculé'), ('valide', 'Validé'), ('paye', 'Payé'), ('cloture', 'Clôturé')], default='ouvert', max_length=15)),
                ('date_calcul', models.DateTimeField(blank=True, null=True)),
                ('date_validation', models.DateTimeField(blank=True, null=True)),
                ('date_paiement', models.DateField(blank=True, null=True)),
                ('date_cloture', models.DateTimeField(blank=True, null=True)),
                ('observations', models.TextField(blank=True, null=True)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('cloture_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='dossiers_paie_clotures', to=settings.AUTH_USER_MODEL)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='dossiers_paie', to='core.entreprise')),
                ('valide_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='dossiers_paie_valides', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Dossier de paie',
                'verbose_name_plural': 'Dossiers de paie',
                'db_table': 'paie_dossier',
                'ordering': ['-annee', '-mois'],
                'unique_together': {('entreprise', 'annee', 'mois')},
            },
        ),
        migrations.CreateModel(
            name='AffiliationMutuelle',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('date_affiliation', models.DateField()),
                ('date_fin', models.DateField(blank=True, null=True)),
                ('statut', models.CharField(choices=[('active', 'Active'), ('suspendue', 'Suspendue'), ('resiliee', 'Résiliée')], default='active', max_length=15)),
                ('inclut_conjoint', models.BooleanField(default=False)),
                ('nombre_enfants', models.IntegerField(default=0)),
                ('cotisation_mensuelle', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('employe', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='affiliations_mutuelle', to='employes.employe')),
                ('mutuelle', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='affiliations', to='paie.mutuelleentreprise')),
            ],
            options={
                'verbose_name': 'Affiliation mutuelle',
                'verbose_name_plural': 'Affiliations mutuelle',
                'db_table': 'paie_affiliation_mutuelle',
                'unique_together': {('mutuelle', 'employe')},
            },
        ),
        migrations.CreateModel(
            name='AffiliationRetraite',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('date_affiliation', models.DateField()),
                ('date_fin', models.DateField(blank=True, null=True)),
                ('est_active', models.BooleanField(default=True)),
                ('numero_adherent', models.CharField(blank=True, max_length=50, null=True)),
                ('employe', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='affiliations_retraite', to='employes.employe')),
                ('retraite', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='affiliations', to='paie.retraitecomplementaire')),
            ],
            options={
                'verbose_name': 'Affiliation retraite',
                'verbose_name_plural': 'Affiliations retraite',
                'db_table': 'paie_affiliation_retraite',
                'unique_together': {('retraite', 'employe')},
            },
        ),
    ]
