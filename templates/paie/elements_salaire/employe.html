{% extends 'base.html' %}
{% load static %}

{% block title %}Éléments de Salaire - {{ employe.nom_complet }} - Gestionnaire RH Guinée{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="bi bi-cash-coin"></i> Éléments de Salaire
        <br><small class="text-muted">{{ employe.nom_complet }} ({{ employe.matricule }})</small>
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{% url 'paie:ajouter_element_salaire' employe.id %}" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Ajouter un élément
        </a>
        <a href="{% url 'employes:detail' employe.id %}" class="btn btn-secondary ms-2">
            <i class="bi bi-arrow-left"></i> Retour au profil
        </a>
    </div>
</div>

<!-- Résumé -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card border-left-success shadow-sm">
            <div class="card-body">
                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Total Gains</div>
                <div class="h5 mb-0">{{ total_gains|floatformat:0 }} GNF</div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-left-danger shadow-sm">
            <div class="card-body">
                <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Total Retenues</div>
                <div class="h5 mb-0">{{ total_retenues|floatformat:0 }} GNF</div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card border-left-primary shadow-sm">
            <div class="card-body">
                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Net Estimé</div>
                <div class="h5 mb-0">{{ total_gains|add:"-"|add:total_retenues|floatformat:0 }} GNF</div>
            </div>
        </div>
    </div>
</div>

<!-- Gains -->
<div class="card shadow mb-4">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0"><i class="bi bi-plus-circle"></i> Gains ({{ gains.count }})</h5>
    </div>
    <div class="card-body">
        {% if gains %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Rubrique</th>
                        <th>Type</th>
                        <th>Montant/Taux</th>
                        <th>Date début</th>
                        <th>Date fin</th>
                        <th>Statut</th>
                        <th>Récurrent</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for element in gains %}
                    <tr>
                        <td>
                            <strong>{{ element.rubrique.libelle_rubrique }}</strong><br>
                            <small class="text-muted">{{ element.rubrique.code_rubrique }}</small>
                        </td>
                        <td><span class="badge bg-success">{{ element.rubrique.get_type_rubrique_display }}</span></td>
                        <td>
                            {% if element.montant %}
                                <strong>{{ element.montant|floatformat:0 }} GNF</strong>
                            {% elif element.taux %}
                                <strong>{{ element.taux }}%</strong>
                                <br><small class="text-muted">Base: {{ element.base_calcul }}</small>
                            {% else %}
                                <span class="text-muted">Non défini</span>
                            {% endif %}
                        </td>
                        <td>{{ element.date_debut|date:"d/m/Y" }}</td>
                        <td>{{ element.date_fin|date:"d/m/Y"|default:"-" }}</td>
                        <td>
                            {% if element.actif %}
                                <span class="badge bg-success">Actif</span>
                            {% else %}
                                <span class="badge bg-secondary">Inactif</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if element.recurrent %}
                                <i class="bi bi-check-circle text-success"></i> Oui
                            {% else %}
                                <i class="bi bi-x-circle text-danger"></i> Non
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <a href="{% url 'paie:modifier_element_salaire' element.id %}" class="btn btn-outline-primary" title="Modifier">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{% url 'paie:supprimer_element_salaire' element.id %}" class="btn btn-outline-danger" title="Supprimer">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> Aucun gain défini pour cet employé.
        </div>
        {% endif %}
    </div>
</div>

<!-- Retenues -->
<div class="card shadow mb-4">
    <div class="card-header bg-danger text-white">
        <h5 class="mb-0"><i class="bi bi-dash-circle"></i> Retenues ({{ retenues.count }})</h5>
    </div>
    <div class="card-body">
        {% if retenues %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Rubrique</th>
                        <th>Type</th>
                        <th>Montant/Taux</th>
                        <th>Date début</th>
                        <th>Date fin</th>
                        <th>Statut</th>
                        <th>Récurrent</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for element in retenues %}
                    <tr>
                        <td>
                            <strong>{{ element.rubrique.libelle_rubrique }}</strong><br>
                            <small class="text-muted">{{ element.rubrique.code_rubrique }}</small>
                        </td>
                        <td><span class="badge bg-danger">{{ element.rubrique.get_type_rubrique_display }}</span></td>
                        <td>
                            {% if element.montant %}
                                <strong>{{ element.montant|floatformat:0 }} GNF</strong>
                            {% elif element.taux %}
                                <strong>{{ element.taux }}%</strong>
                                <br><small class="text-muted">Base: {{ element.base_calcul }}</small>
                            {% else %}
                                <span class="text-muted">Non défini</span>
                            {% endif %}
                        </td>
                        <td>{{ element.date_debut|date:"d/m/Y" }}</td>
                        <td>{{ element.date_fin|date:"d/m/Y"|default:"-" }}</td>
                        <td>
                            {% if element.actif %}
                                <span class="badge bg-success">Actif</span>
                            {% else %}
                                <span class="badge bg-secondary">Inactif</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if element.recurrent %}
                                <i class="bi bi-check-circle text-success"></i> Oui
                            {% else %}
                                <i class="bi bi-x-circle text-danger"></i> Non
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <a href="{% url 'paie:modifier_element_salaire' element.id %}" class="btn btn-outline-primary" title="Modifier">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{% url 'paie:supprimer_element_salaire' element.id %}" class="btn btn-outline-danger" title="Supprimer">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> Aucune retenue définie pour cet employé.
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
