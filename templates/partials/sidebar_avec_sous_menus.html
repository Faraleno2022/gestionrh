<!-- SIDEBAR AVEC SOUS-MENUS D√âROULANTS -->
<!-- Version am√©lior√©e avec tous les liens organis√©s en sous-menus -->

<style>
    .submenu {
        padding-left: 2rem;
        display: none;
    }
    .submenu.show {
        display: block;
    }
    .menu-toggle {
        cursor: pointer;
        user-select: none;
    }
    .menu-toggle i.bi-chevron-down {
        transition: transform 0.3s;
    }
    .menu-toggle.active i.bi-chevron-down {
        transform: rotate(180deg);
    }
    .nav-link-submenu {
        font-size: 0.9rem;
        padding: 0.4rem 1rem;
    }
</style>

<div class="position-sticky pt-3">
    <ul class="nav flex-column">
        <!-- Tableau de bord -->
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'index' %}active{% endif %}" href="{% url 'dashboard:index' %}">
                <i class="bi bi-speedometer2"></i> Tableau de bord
            </a>
        </li>
        
        <!-- GESTION DES EMPLOY√âS -->
        <li class="nav-item">
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                <span>GESTION</span>
            </h6>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('employes-menu')">
                <i class="bi bi-people"></i> Employ√©s
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="employes-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'employes:list' %}">
                    <i class="bi bi-list-ul"></i> Liste des employ√©s
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'employes:create' %}">
                    <i class="bi bi-person-plus"></i> Nouvel employ√©
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'employes:export_excel' %}">
                    <i class="bi bi-file-earmark-excel"></i> Export Excel
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'employes:liste_missions' %}">
                    <i class="bi bi-airplane"></i> Missions
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'employes:liste_reclamations' %}">
                    <i class="bi bi-chat-left-text"></i> R√©clamations
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'employes:liste_visites_medicales' %}">
                    <i class="bi bi-heart-pulse"></i> Visites m√©dicales
                </a></li>
            </ul>
        </li>
        
        <!-- TEMPS DE TRAVAIL -->
        <li class="nav-item">
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                <span>TEMPS DE TRAVAIL</span>
            </h6>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'temps_travail:home' %}">
                <i class="bi bi-house-door"></i> Tableau de bord
            </a>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('pointages-menu')">
                <i class="bi bi-clock"></i> Pointages
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="pointages-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'temps_travail:pointages' %}">
                    <i class="bi bi-list-ul"></i> Liste des pointages
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'temps_travail:creer_pointage' %}">
                    <i class="bi bi-plus-circle"></i> Nouveau pointage
                </a></li>
            </ul>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('conges-menu')">
                <i class="bi bi-calendar-check"></i> Cong√©s
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="conges-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'temps_travail:conges' %}">
                    <i class="bi bi-list-ul"></i> Liste des demandes
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'temps_travail:creer_conge' %}">
                    <i class="bi bi-plus-circle"></i> Nouvelle demande
                </a></li>
            </ul>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('absences-menu')">
                <i class="bi bi-person-x"></i> Absences
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="absences-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'temps_travail:absences' %}">
                    <i class="bi bi-list-ul"></i> Liste des absences
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'temps_travail:creer_absence' %}">
                    <i class="bi bi-plus-circle"></i> Enregistrer une absence
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'temps_travail:calendrier_absences' %}">
                    <i class="bi bi-calendar3"></i> Calendrier
                </a></li>
            </ul>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('heures-sup-menu')">
                <i class="bi bi-hourglass-split"></i> Heures Supp.
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="heures-sup-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'temps_travail:liste_heures_supplementaires' %}">
                    <i class="bi bi-list-ul"></i> Liste
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'temps_travail:ajouter_heure_supplementaire' %}">
                    <i class="bi bi-plus-circle"></i> Ajouter
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'temps_travail:recap_heures_supplementaires' %}">
                    <i class="bi bi-graph-up"></i> R√©capitulatif
                </a></li>
            </ul>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('feries-menu')">
                <i class="bi bi-calendar-event"></i> Jours F√©ri√©s
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="feries-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'temps_travail:liste_jours_feries' %}">
                    <i class="bi bi-list-ul"></i> Calendrier
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'temps_travail:creer_jour_ferie' %}">
                    <i class="bi bi-plus-circle"></i> Ajouter un jour f√©ri√©
                </a></li>
            </ul>
        </li>
        
        <!-- PAIE -->
        <li class="nav-item">
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                <span>PAIE</span>
            </h6>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'paie:home' %}">
                <i class="bi bi-house-door"></i> Tableau de bord
            </a>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('periodes-menu')">
                <i class="bi bi-calendar3"></i> P√©riodes de paie
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="periodes-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'paie:liste_periodes' %}">
                    <i class="bi bi-list-ul"></i> Liste des p√©riodes
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'paie:creer_periode' %}">
                    <i class="bi bi-plus-circle"></i> Nouvelle p√©riode
                </a></li>
            </ul>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'paie:liste_bulletins' %}">
                <i class="bi bi-file-earmark-text"></i> Bulletins de paie
            </a>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('elements-menu')">
                <i class="bi bi-cash-coin"></i> √âl√©ments de Salaire
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="elements-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'paie:liste_elements_salaire' %}">
                    <i class="bi bi-list-ul"></i> G√©rer les √©l√©ments
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'paie:liste_rubriques' %}">
                    <i class="bi bi-list-check"></i> Rubriques de paie
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'paie:bareme_irpp_liste' %}">
                    <i class="bi bi-percent"></i> Bar√®me RTS
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'paie:simulateur_irpp' %}">
                    <i class="bi bi-calculator"></i> Simulateur RTS
                </a></li>
            </ul>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('prets-frais-menu')">
                <i class="bi bi-wallet2"></i> Pr√™ts & Frais
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="prets-frais-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'paie:liste_prets' %}">
                    <i class="bi bi-cash"></i> Gestion des pr√™ts
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'paie:liste_notes_frais' %}">
                    <i class="bi bi-receipt"></i> Notes de frais
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'paie:tableau_bord_echeances' %}">
                    <i class="bi bi-bell"></i> Alertes √©ch√©ances
                </a></li>
            </ul>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'paie:livre_paie' %}">
                <i class="bi bi-book"></i> Livre de paie
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'paie:historique_bulletins' %}">
                <i class="bi bi-clock-history"></i> Historique bulletins
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'paie:liste_archives' %}">
                <i class="bi bi-archive"></i> Archives (tra√ßabilit√©)
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'paie:simulation_paie' %}">
                <i class="bi bi-calculator"></i> Simulation paie
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'paie:declarations_sociales' %}">
                <i class="bi bi-file-earmark-spreadsheet"></i> D√©clarations sociales
            </a>
        </li>
        
        <!-- MODULES -->
        <li class="nav-item">
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                <span>MODULES</span>
            </h6>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('recrutement-menu')">
                <i class="bi bi-briefcase"></i> Recrutement
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="recrutement-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'recrutement:home' %}">
                    <i class="bi bi-house-door"></i> Tableau de bord
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'recrutement:offres' %}">
                    <i class="bi bi-megaphone"></i> Offres d'emploi
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'recrutement:candidatures' %}">
                    <i class="bi bi-file-person"></i> Candidatures
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'recrutement:entretiens' %}">
                    <i class="bi bi-calendar-event"></i> Entretiens
                </a></li>
            </ul>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('formation-menu')">
                <i class="bi bi-mortarboard"></i> Formation
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="formation-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'formation:home' %}">
                    <i class="bi bi-house-door"></i> Tableau de bord
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'formation:catalogue' %}">
                    <i class="bi bi-list-ul"></i> Catalogue
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'formation:sessions' %}">
                    <i class="bi bi-calendar-week"></i> Sessions
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'formation:inscriptions' %}">
                    <i class="bi bi-person-check"></i> Inscriptions
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'formation:plans' %}">
                    <i class="bi bi-clipboard-data"></i> Plan de formation
                </a></li>
            </ul>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('evaluations-menu')">
                <i class="bi bi-clipboard-check"></i> √âvaluations
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="evaluations-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'employes:liste_campagnes' %}">
                    <i class="bi bi-calendar-range"></i> Campagnes
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'employes:creer_campagne' %}">
                    <i class="bi bi-plus-circle"></i> Nouvelle campagne
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'employes:synthese_evaluations' %}">
                    <i class="bi bi-graph-up-arrow"></i> Synth√®se
                </a></li>
            </ul>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('cnss-menu')">
                <i class="bi bi-building"></i> CNSS
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="cnss-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'core:cnss_dashboard' %}">
                    <i class="bi bi-speedometer2"></i> Tableau de bord
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'core:cnss_generer' %}">
                    <i class="bi bi-file-earmark-plus"></i> G√©n√©rer d√©claration
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'core:cnss_historique' %}">
                    <i class="bi bi-clock-history"></i> Historique
                </a></li>
            </ul>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('expatries-menu')">
                <i class="bi bi-globe"></i> Expatri√©s
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="expatries-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'core:expatries_liste' %}">
                    <i class="bi bi-list-ul"></i> Liste des expatri√©s
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'core:expatrie_ajouter' %}">
                    <i class="bi bi-person-plus"></i> Ajouter expatri√©
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'core:alertes_expatries' %}">
                    <i class="bi bi-bell"></i> Alertes permis
                </a></li>
            </ul>
        </li>
        
        <li class="nav-item">
            <div class="nav-link menu-toggle" onclick="toggleSubmenu('inspection-menu')">
                <i class="bi bi-shield-check"></i> Inspection
                <i class="bi bi-chevron-down float-end"></i>
            </div>
            <ul class="submenu" id="inspection-menu">
                <li><a class="nav-link nav-link-submenu" href="{% url 'core:inspection_dashboard' %}">
                    <i class="bi bi-speedometer2"></i> Tableau de bord
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'core:registres_liste' %}">
                    <i class="bi bi-journal-text"></i> Registres
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'core:visites_liste' %}">
                    <i class="bi bi-calendar-check"></i> Visites
                </a></li>
                <li><a class="nav-link nav-link-submenu" href="{% url 'core:checklist_conformite' %}">
                    <i class="bi bi-list-check"></i> Checklist conformit√©
                </a></li>
            </ul>
        </li>
        
        <!-- RAPPORTS -->
        <li class="nav-item">
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                <span>RAPPORTS</span>
            </h6>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'dashboard:rapports' %}">
                <i class="bi bi-graph-up"></i> Statistiques g√©n√©rales
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'dashboard:statistiques_paie' %}">
                <i class="bi bi-cash-coin"></i> Statistiques paie
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'temps_travail:rapport_presence' %}">
                <i class="bi bi-clipboard-data"></i> Rapport pr√©sence
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'temps_travail:rapport_heures_supplementaires' %}">
                <i class="bi bi-clock-history"></i> Heures suppl√©mentaires
            </a>
        </li>
        
        <!-- ADMINISTRATION -->
        {% if user.profil.niveau_acces >= 4 %}
        <li class="nav-item">
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                <span>ADMINISTRATION</span>
            </h6>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'core:users' %}">
                <i class="bi bi-person-badge"></i> Utilisateurs
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'core:gestion_structure' %}">
                <i class="bi bi-diagram-3"></i> Structure entreprise
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link" href="{% url 'core:parametres' %}">
                <i class="bi bi-gear"></i> Param√®tres
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link text-success" href="{% url 'core:telecharger_documentation' %}">
                <i class="bi bi-file-earmark-zip"></i> üìö Documentation CGI 2022
            </a>
        </li>
        {% endif %}
        
        <!-- PORTAIL EMPLOY√â -->
        <li class="nav-item mt-4 border-top pt-3">
            <a class="nav-link" href="{% url 'portail:accueil' %}">
                <i class="bi bi-person-workspace"></i> Portail Employ√©
            </a>
        </li>
        
        <!-- MON PROFIL (en bas) -->
        <li class="nav-item">
            <a class="nav-link" href="{% url 'core:profile' %}">
                <i class="bi bi-person-circle"></i> Mon Profil
            </a>
        </li>
    </ul>
</div>

<script>
function toggleSubmenu(menuId) {
    const submenu = document.getElementById(menuId);
    const toggle = submenu.previousElementSibling;
    
    // Fermer tous les autres sous-menus
    document.querySelectorAll('.submenu').forEach(menu => {
        if (menu.id !== menuId) {
            menu.classList.remove('show');
            menu.previousElementSibling.classList.remove('active');
        }
    });
    
    // Toggle le menu actuel
    submenu.classList.toggle('show');
    toggle.classList.toggle('active');
}

// Ouvrir automatiquement le sous-menu si on est sur une de ses pages
document.addEventListener('DOMContentLoaded', function() {
    const currentPath = window.location.pathname;
    document.querySelectorAll('.submenu a').forEach(link => {
        if (link.getAttribute('href') === currentPath) {
            const submenu = link.closest('.submenu');
            submenu.classList.add('show');
            submenu.previousElementSibling.classList.add('active');
        }
    });
});
</script>

