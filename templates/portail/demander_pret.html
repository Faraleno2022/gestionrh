{% extends 'portail/base_portail.html' %}
{% load static %}

{% block title %}Demander un Prêt{% endblock %}

{% block portail_content %}
<div class="row mb-4">
    <div class="col-12">
        <a href="{% url 'portail:mes_prets' %}" class="btn btn-outline-secondary mb-3">
            <i class="fas fa-arrow-left me-2"></i>Retour
        </a>
        <h2><i class="fas fa-hand-holding-usd me-2"></i>Demander un Prêt</h2>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card shadow-sm">
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="type_pret" class="form-label">Type de prêt *</label>
                        <select class="form-select" id="type_pret" name="type_pret" required>
                            {% for code, libelle in types_pret %}
                            <option value="{{ code }}">{{ libelle }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="montant" class="form-label">Montant demandé *</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="montant" name="montant" required>
                                <span class="input-group-text">GNF</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="nombre_echeances" class="form-label">Nombre d'échéances *</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="nombre_echeances" name="nombre_echeances" 
                                       value="1" min="1" max="36" required>
                                <span class="input-group-text">mois</span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="motif" class="form-label">Motif de la demande</label>
                        <textarea class="form-control" id="motif" name="motif" rows="3" 
                                  placeholder="Précisez le motif de votre demande..."></textarea>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{% url 'portail:mes_prets' %}" class="btn btn-secondary">Annuler</a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane me-2"></i>Soumettre la demande
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card bg-light">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-calculator me-2"></i>Simulation</h6>
            </div>
            <div class="card-body">
                <div id="simulation">
                    <p class="text-muted small">Remplissez le formulaire pour voir la simulation</p>
                </div>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Information</h6>
            </div>
            <div class="card-body small">
                <p>Votre demande sera soumise à la direction pour approbation.</p>
                <p>Le remboursement débutera le mois suivant l'approbation.</p>
                <p class="mb-0">Les mensualités seront prélevées sur votre salaire.</p>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const montantInput = document.getElementById('montant');
    const echeancesInput = document.getElementById('nombre_echeances');
    const simulationDiv = document.getElementById('simulation');
    
    function calculerSimulation() {
        const montant = parseFloat(montantInput.value.replace(/\s/g, '').replace(',', '.')) || 0;
        const echeances = parseInt(echeancesInput.value) || 1;
        
        if (montant > 0 && echeances > 0) {
            const mensualite = montant / echeances;
            
            simulationDiv.innerHTML = `
                <table class="table table-sm mb-0">
                    <tr><td>Montant</td><td class="text-end">${montant.toLocaleString('fr-FR')} GNF</td></tr>
                    <tr class="table-success"><td><strong>Mensualité</strong></td><td class="text-end"><strong>${Math.round(mensualite).toLocaleString('fr-FR')} GNF</strong></td></tr>
                </table>
            `;
        }
    }
    
    montantInput.addEventListener('input', calculerSimulation);
    echeancesInput.addEventListener('input', calculerSimulation);
});
</script>
{% endblock %}
