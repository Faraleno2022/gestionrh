# Generated by Django 5.2.7 on 2025-12-17 12:58

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0005_societe_entreprise'),
        ('employes', '0004_accidenttravail_avenantcontrat_equipementprotection_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='Devise',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(help_text='Code ISO (GNF, USD, EUR)', max_length=3, unique=True)),
                ('nom', models.CharField(max_length=50)),
                ('symbole', models.CharField(max_length=5)),
                ('est_devise_base', models.BooleanField(default=False, help_text='GNF est la devise de base')),
                ('actif', models.BooleanField(default=True)),
            ],
            options={
                'verbose_name': 'Devise',
                'verbose_name_plural': 'Devises',
                'db_table': 'devises',
            },
        ),
        migrations.CreateModel(
            name='ConfigurationCNSS',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('numero_employeur', models.CharField(help_text='Numéro employeur CNSS', max_length=50)),
                ('code_agence', models.CharField(blank=True, max_length=20, null=True)),
                ('api_url', models.URLField(blank=True, help_text='URL API télédéclaration CNSS', null=True)),
                ('api_username', models.CharField(blank=True, max_length=100, null=True)),
                ('api_password', models.CharField(blank=True, max_length=100, null=True)),
                ('api_token', models.TextField(blank=True, null=True)),
                ('mode_declaration', models.CharField(choices=[('manuel', 'Manuel (fichier)'), ('api', 'API automatique')], default='manuel', max_length=20)),
                ('format_fichier', models.CharField(choices=[('csv', 'CSV'), ('xml', 'XML'), ('json', 'JSON')], default='csv', max_length=20)),
                ('actif', models.BooleanField(default=True)),
                ('date_derniere_synchro', models.DateTimeField(blank=True, null=True)),
                ('entreprise', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='config_cnss', to='core.entreprise')),
            ],
            options={
                'verbose_name': 'Configuration CNSS',
                'db_table': 'config_cnss',
            },
        ),
        migrations.CreateModel(
            name='Expatrie',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('type_contrat_expat', models.CharField(choices=[('detachement', 'Détachement'), ('expatriation', 'Expatriation'), ('local_plus', 'Local Plus'), ('vip', 'VIP/Impatrié')], max_length=30)),
                ('pays_origine', models.CharField(max_length=100)),
                ('salaire_local_pct', models.DecimalField(decimal_places=2, default=100, help_text='% payé en GNF', max_digits=5)),
                ('salaire_origine_pct', models.DecimalField(decimal_places=2, default=0, help_text='% payé en devise origine', max_digits=5)),
                ('prime_expatriation', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('indemnite_logement', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('indemnite_scolarite', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('billet_avion_annuel', models.IntegerField(default=0, help_text='Nombre de billets A/R par an')),
                ('maintien_secu_origine', models.BooleanField(default=False, help_text="Maintien sécurité sociale pays d'origine")),
                ('assurance_rapatriement', models.BooleanField(default=True)),
                ('date_debut_mission', models.DateField()),
                ('date_fin_mission_prevue', models.DateField(blank=True, null=True)),
                ('observations', models.TextField(blank=True, null=True)),
                ('devise_salaire', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='expatries', to='core.devise')),
                ('employe', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='info_expatrie', to='employes.employe')),
            ],
            options={
                'verbose_name': 'Expatrié',
                'verbose_name_plural': 'Expatriés',
                'db_table': 'expatries',
            },
        ),
        migrations.CreateModel(
            name='PermisVisa',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('type_document', models.CharField(choices=[('visa_travail', 'Visa de travail'), ('visa_affaires', "Visa d'affaires"), ('permis_travail', 'Permis de travail'), ('carte_sejour', 'Carte de séjour'), ('autorisation_emploi', "Autorisation d'emploi")], max_length=30)),
                ('numero_document', models.CharField(max_length=50)),
                ('date_emission', models.DateField()),
                ('date_expiration', models.DateField()),
                ('autorite_emission', models.CharField(help_text="Ex: Direction Nationale de l'Emploi", max_length=100)),
                ('statut', models.CharField(choices=[('en_cours', 'En cours de validité'), ('expire', 'Expiré'), ('en_renouvellement', 'En renouvellement'), ('refuse', 'Refusé')], default='en_cours', max_length=20)),
                ('alerte_renouvellement_jours', models.IntegerField(default=60, help_text='Jours avant expiration pour alerte')),
                ('fichier_document', models.FileField(blank=True, null=True, upload_to='expatries/permis/')),
                ('observations', models.TextField(blank=True, null=True)),
                ('expatrie', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='permis_visas', to='core.expatrie')),
            ],
            options={
                'verbose_name': 'Permis/Visa',
                'verbose_name_plural': 'Permis/Visas',
                'db_table': 'permis_visas',
                'ordering': ['-date_expiration'],
            },
        ),
        migrations.CreateModel(
            name='VisiteInspection',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date_visite', models.DateField()),
                ('type_visite', models.CharField(choices=[('routine', 'Visite de routine'), ('controle', 'Contrôle'), ('enquete', 'Enquête'), ('suite_plainte', 'Suite à plainte'), ('verification', 'Vérification')], max_length=30)),
                ('nom_inspecteur', models.CharField(max_length=100)),
                ('matricule_inspecteur', models.CharField(blank=True, max_length=50, null=True)),
                ('direction_regionale', models.CharField(blank=True, max_length=100, null=True)),
                ('objet_visite', models.TextField()),
                ('points_controles', models.TextField(blank=True, help_text='Points vérifiés', null=True)),
                ('resultat', models.CharField(blank=True, choices=[('conforme', 'Conforme'), ('observations', 'Observations'), ('mise_demeure', 'Mise en demeure'), ('pv_infraction', "PV d'infraction")], max_length=30, null=True)),
                ('observations_inspecteur', models.TextField(blank=True, null=True)),
                ('recommandations', models.TextField(blank=True, null=True)),
                ('pv_visite', models.FileField(blank=True, null=True, upload_to='inspection/pv/')),
                ('mise_demeure', models.FileField(blank=True, null=True, upload_to='inspection/mises_demeure/')),
                ('date_limite_regularisation', models.DateField(blank=True, null=True)),
                ('regularisation_effectuee', models.BooleanField(default=False)),
                ('date_regularisation', models.DateField(blank=True, null=True)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='visites_inspection', to='core.entreprise')),
            ],
            options={
                'verbose_name': 'Visite inspection',
                'verbose_name_plural': 'Visites inspection',
                'db_table': 'visites_inspection',
                'ordering': ['-date_visite'],
            },
        ),
        migrations.CreateModel(
            name='NonConformite',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('reference', models.CharField(max_length=50)),
                ('article_code_travail', models.CharField(blank=True, help_text='Article du Code du Travail', max_length=50, null=True)),
                ('description', models.TextField()),
                ('gravite', models.CharField(choices=[('mineure', 'Mineure'), ('majeure', 'Majeure'), ('critique', 'Critique')], max_length=20)),
                ('action_corrective', models.TextField(blank=True, null=True)),
                ('responsable_action', models.CharField(blank=True, max_length=100, null=True)),
                ('date_echeance', models.DateField(blank=True, null=True)),
                ('statut', models.CharField(choices=[('ouverte', 'Ouverte'), ('en_cours', 'En cours de traitement'), ('resolue', 'Résolue'), ('fermee', 'Fermée')], default='ouverte', max_length=20)),
                ('date_resolution', models.DateField(blank=True, null=True)),
                ('preuve_resolution', models.FileField(blank=True, null=True, upload_to='inspection/preuves/')),
                ('visite', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='non_conformites', to='core.visiteinspection')),
            ],
            options={
                'verbose_name': 'Non-conformité',
                'verbose_name_plural': 'Non-conformités',
                'db_table': 'non_conformites',
                'ordering': ['-visite__date_visite', 'gravite'],
            },
        ),
        migrations.CreateModel(
            name='BaremeIRPP',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('annee', models.IntegerField()),
                ('tranche_numero', models.IntegerField()),
                ('revenu_min', models.DecimalField(decimal_places=2, max_digits=15)),
                ('revenu_max', models.DecimalField(blank=True, decimal_places=2, help_text='Null = illimité', max_digits=15, null=True)),
                ('taux', models.DecimalField(decimal_places=2, help_text='Taux en %', max_digits=5)),
                ('montant_cumule_precedent', models.DecimalField(decimal_places=2, default=0, help_text='Impôt cumulé des tranches précédentes', max_digits=15)),
                ('actif', models.BooleanField(default=True)),
                ('entreprise', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='baremes_irpp', to='core.entreprise')),
            ],
            options={
                'verbose_name': 'Tranche IRPP',
                'verbose_name_plural': 'Barème IRPP',
                'db_table': 'baremes_irpp',
                'ordering': ['annee', 'tranche_numero'],
                'unique_together': {('entreprise', 'annee', 'tranche_numero')},
            },
        ),
        migrations.CreateModel(
            name='DeductionFiscale',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('annee', models.IntegerField()),
                ('type_deduction', models.CharField(choices=[('conjoint', 'Conjoint à charge'), ('enfant', 'Enfant à charge'), ('ascendant', 'Ascendant à charge'), ('handicap', 'Personne handicapée'), ('assurance_vie', 'Assurance vie'), ('epargne_retraite', 'Épargne retraite')], max_length=30)),
                ('montant_deduction', models.DecimalField(decimal_places=2, help_text='Montant de la déduction', max_digits=15)),
                ('plafond', models.DecimalField(blank=True, decimal_places=2, help_text='Plafond si applicable', max_digits=15, null=True)),
                ('nombre_max', models.IntegerField(blank=True, help_text='Nombre max (ex: 4 enfants)', null=True)),
                ('conditions', models.TextField(blank=True, help_text="Conditions d'application", null=True)),
                ('actif', models.BooleanField(default=True)),
                ('entreprise', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='deductions_fiscales', to='core.entreprise')),
            ],
            options={
                'verbose_name': 'Déduction fiscale',
                'verbose_name_plural': 'Déductions fiscales',
                'db_table': 'deductions_fiscales',
                'unique_together': {('entreprise', 'annee', 'type_deduction')},
            },
        ),
        migrations.CreateModel(
            name='ParametrePaieDevise',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('annee', models.IntegerField()),
                ('plafond_cnss', models.DecimalField(decimal_places=2, default=0, help_text='Plafond CNSS dans cette devise', max_digits=15)),
                ('seuil_irpp', models.DecimalField(decimal_places=2, default=0, help_text="Seuil d'imposition IRPP", max_digits=15)),
                ('actif', models.BooleanField(default=True)),
                ('devise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.devise')),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='params_paie_devise', to='core.entreprise')),
            ],
            options={
                'verbose_name': 'Paramètre paie devise',
                'verbose_name_plural': 'Paramètres paie devises',
                'db_table': 'parametres_paie_devise',
                'unique_together': {('entreprise', 'devise', 'annee')},
            },
        ),
        migrations.CreateModel(
            name='RegistreObligatoire',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('type_registre', models.CharField(choices=[('personnel', 'Registre du personnel'), ('paie', 'Registre de paie'), ('conges', 'Registre des congés'), ('accidents', 'Registre des accidents du travail'), ('delegues', 'Registre des délégués du personnel'), ('heures_sup', 'Registre des heures supplémentaires'), ('visites_medicales', 'Registre des visites médicales'), ('sanctions', 'Registre des sanctions')], max_length=30)),
                ('annee', models.IntegerField()),
                ('numero_registre', models.CharField(blank=True, max_length=50, null=True)),
                ('date_ouverture', models.DateField()),
                ('date_cloture', models.DateField(blank=True, null=True)),
                ('vise_inspection', models.BooleanField(default=False)),
                ('date_visa', models.DateField(blank=True, null=True)),
                ('numero_visa', models.CharField(blank=True, max_length=50, null=True)),
                ('fichier_registre', models.FileField(blank=True, null=True, upload_to='registres/')),
                ('observations', models.TextField(blank=True, null=True)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='registres_obligatoires', to='core.entreprise')),
            ],
            options={
                'verbose_name': 'Registre obligatoire',
                'verbose_name_plural': 'Registres obligatoires',
                'db_table': 'registres_obligatoires',
                'unique_together': {('entreprise', 'type_registre', 'annee')},
            },
        ),
        migrations.CreateModel(
            name='TauxChange',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('taux', models.DecimalField(decimal_places=6, help_text='1 devise_source = X devise_cible', max_digits=15)),
                ('date_taux', models.DateField()),
                ('source', models.CharField(blank=True, help_text='Source du taux (BCRG, marché, etc.)', max_length=100, null=True)),
                ('devise_cible', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='taux_cible', to='core.devise')),
                ('devise_source', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='taux_source', to='core.devise')),
                ('entreprise', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='taux_changes', to='core.entreprise')),
            ],
            options={
                'verbose_name': 'Taux de change',
                'verbose_name_plural': 'Taux de change',
                'db_table': 'taux_changes',
                'ordering': ['-date_taux'],
                'unique_together': {('devise_source', 'devise_cible', 'date_taux')},
            },
        ),
        migrations.CreateModel(
            name='TransmissionCNSS',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('periode_mois', models.IntegerField()),
                ('periode_annee', models.IntegerField()),
                ('reference', models.CharField(max_length=50, unique=True)),
                ('nombre_salaries', models.IntegerField(default=0)),
                ('masse_salariale_brute', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('base_cnss_totale', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('cotisation_employe', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('cotisation_employeur', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('total_cotisations', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('fichier_declaration', models.FileField(blank=True, null=True, upload_to='cnss/declarations/')),
                ('statut', models.CharField(choices=[('brouillon', 'Brouillon'), ('genere', 'Fichier généré'), ('transmis', 'Transmis'), ('accepte', 'Accepté'), ('rejete', 'Rejeté'), ('erreur', 'Erreur')], default='brouillon', max_length=20)),
                ('date_generation', models.DateTimeField(blank=True, null=True)),
                ('date_transmission', models.DateTimeField(blank=True, null=True)),
                ('date_reponse', models.DateTimeField(blank=True, null=True)),
                ('numero_accuse', models.CharField(blank=True, max_length=50, null=True)),
                ('message_retour', models.TextField(blank=True, null=True)),
                ('fichier_accuse', models.FileField(blank=True, null=True, upload_to='cnss/accuses/')),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transmissions_cnss', to='core.entreprise')),
                ('genere_par', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Transmission CNSS',
                'verbose_name_plural': 'Transmissions CNSS',
                'db_table': 'transmissions_cnss',
                'ordering': ['-periode_annee', '-periode_mois'],
                'unique_together': {('entreprise', 'periode_mois', 'periode_annee')},
            },
        ),
    ]
