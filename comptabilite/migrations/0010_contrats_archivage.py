# Generated by Django 5.2.7 on 2026-01-29 20:48

import django.db.models.deletion
import uuid
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('comptabilite', '0009_remove_declaration_irpp'),
        ('core', '0011_add_expatrie_fields'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ArchiveDocument',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('reference', models.CharField(max_length=100)),
                ('titre', models.CharField(max_length=300)),
                ('description', models.TextField(blank=True, null=True)),
                ('fichier', models.FileField(upload_to='archives/%Y/%m/')),
                ('format_fichier', models.CharField(choices=[('pdf', 'PDF'), ('image', 'Image (JPG, PNG)'), ('excel', 'Excel'), ('word', 'Word'), ('xml', 'XML'), ('autre', 'Autre')], max_length=10)),
                ('taille_octets', models.BigIntegerField(default=0)),
                ('hash_fichier', models.CharField(blank=True, help_text='SHA-256 pour intégrité', max_length=64, null=True)),
                ('date_document', models.DateField()),
                ('date_archivage', models.DateTimeField(auto_now_add=True)),
                ('date_expiration', models.DateField(blank=True, null=True)),
                ('statut', models.CharField(choices=[('actif', 'Actif'), ('archive', 'Archivé'), ('a_detruire', 'À détruire'), ('detruit', 'Détruit')], default='actif', max_length=15)),
                ('niveau_confidentialite', models.CharField(choices=[('public', 'Public'), ('interne', 'Interne'), ('confidentiel', 'Confidentiel'), ('secret', 'Secret')], default='interne', max_length=15)),
                ('archive_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='documents_archives', to=settings.AUTH_USER_MODEL)),
                ('ecriture', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='documents_archives', to='comptabilite.ecriturecomptable')),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='archives_documents', to='core.entreprise')),
                ('exercice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='documents_archives', to='comptabilite.exercicecomptable')),
                ('facture', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='documents_archives', to='comptabilite.facture')),
            ],
            options={
                'verbose_name': 'Document archivé',
                'verbose_name_plural': 'Documents archivés',
                'db_table': 'archivage_document',
                'ordering': ['-date_archivage'],
            },
        ),
        migrations.CreateModel(
            name='AlerteArchivage',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_alerte', models.CharField(choices=[('expiration', 'Document expirant'), ('retention', 'Fin de rétention'), ('validation', 'Validation en attente'), ('integrite', "Problème d'intégrité"), ('espace', 'Espace stockage')], max_length=15)),
                ('niveau', models.CharField(choices=[('info', 'Information'), ('warning', 'Avertissement'), ('critical', 'Critique')], default='warning', max_length=10)),
                ('message', models.TextField()),
                ('date_alerte', models.DateTimeField(auto_now_add=True)),
                ('date_echeance', models.DateField(blank=True, null=True)),
                ('est_lue', models.BooleanField(default=False)),
                ('est_traitee', models.BooleanField(default=False)),
                ('date_traitement', models.DateTimeField(blank=True, null=True)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='alertes_archivage', to='core.entreprise')),
                ('traitee_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('document', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='alertes', to='comptabilite.archivedocument')),
            ],
            options={
                'verbose_name': 'Alerte archivage',
                'verbose_name_plural': 'Alertes archivage',
                'db_table': 'archivage_alerte',
                'ordering': ['-date_alerte'],
            },
        ),
        migrations.CreateModel(
            name='ClassementDocument',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('code', models.CharField(max_length=20)),
                ('libelle', models.CharField(max_length=200)),
                ('type_classement', models.CharField(choices=[('comptable', 'Documents comptables'), ('fiscal', 'Documents fiscaux'), ('social', 'Documents sociaux'), ('juridique', 'Documents juridiques'), ('commercial', 'Documents commerciaux'), ('technique', 'Documents techniques')], max_length=20)),
                ('description', models.TextField(blank=True, null=True)),
                ('niveau', models.IntegerField(default=1)),
                ('chemin', models.CharField(blank=True, help_text='Chemin complet: parent/enfant/...', max_length=500, null=True)),
                ('duree_retention_annees', models.IntegerField(default=10)),
                ('est_actif', models.BooleanField(default=True)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('cree_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='classements_documents', to='core.entreprise')),
                ('parent', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sous_classements', to='comptabilite.classementdocument')),
            ],
            options={
                'verbose_name': 'Classement document',
                'verbose_name_plural': 'Classements documents',
                'db_table': 'archivage_classement',
                'ordering': ['code'],
                'unique_together': {('entreprise', 'code')},
            },
        ),
        migrations.AddField(
            model_name='archivedocument',
            name='classement',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='documents', to='comptabilite.classementdocument'),
        ),
        migrations.CreateModel(
            name='ContratClient',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('numero_contrat', models.CharField(max_length=50)),
                ('reference_client', models.CharField(blank=True, max_length=50, null=True)),
                ('type_contrat', models.CharField(choices=[('vente', 'Contrat de vente'), ('service', 'Contrat de service'), ('abonnement', 'Abonnement'), ('maintenance', 'Contrat de maintenance'), ('projet', 'Contrat projet'), ('cadre', 'Contrat cadre')], max_length=20)),
                ('objet', models.CharField(max_length=300)),
                ('description', models.TextField(blank=True, null=True)),
                ('montant_total', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('montant_annuel', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('devise', models.CharField(default='GNF', max_length=3)),
                ('date_signature', models.DateField()),
                ('date_debut', models.DateField()),
                ('date_fin', models.DateField()),
                ('duree_mois', models.IntegerField(default=12)),
                ('renouvellement_auto', models.BooleanField(default=False)),
                ('preavis_resiliation_jours', models.IntegerField(default=30)),
                ('statut', models.CharField(choices=[('brouillon', 'Brouillon'), ('en_negociation', 'En négociation'), ('actif', 'Actif'), ('suspendu', 'Suspendu'), ('expire', 'Expiré'), ('resilie', 'Résilié')], default='brouillon', max_length=20)),
                ('document_contrat', models.FileField(blank=True, null=True, upload_to='contrats/clients/')),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('date_modification', models.DateTimeField(auto_now=True)),
                ('client', models.ForeignKey(limit_choices_to={'type_tiers': 'client'}, on_delete=django.db.models.deletion.CASCADE, related_name='contrats_client', to='comptabilite.tiers')),
                ('cree_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contrats_clients_crees', to=settings.AUTH_USER_MODEL)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='contrats_clients', to='core.entreprise')),
                ('responsable', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contrats_clients_responsable', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Contrat client',
                'verbose_name_plural': 'Contrats clients',
                'db_table': 'contrats_client',
                'ordering': ['-date_debut'],
                'unique_together': {('entreprise', 'numero_contrat')},
            },
        ),
        migrations.CreateModel(
            name='ContratFournisseur',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('numero_contrat', models.CharField(max_length=50)),
                ('reference_externe', models.CharField(blank=True, help_text='Référence chez le fournisseur', max_length=50, null=True)),
                ('type_contrat', models.CharField(choices=[('achat', "Contrat d'achat"), ('service', 'Contrat de service'), ('maintenance', 'Contrat de maintenance'), ('location', 'Contrat de location'), ('prestation', 'Contrat de prestation'), ('cadre', 'Contrat cadre')], max_length=20)),
                ('objet', models.CharField(max_length=300)),
                ('description', models.TextField(blank=True, null=True)),
                ('montant_total', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('montant_annuel', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('devise', models.CharField(default='GNF', max_length=3)),
                ('date_signature', models.DateField()),
                ('date_debut', models.DateField()),
                ('date_fin', models.DateField()),
                ('duree_mois', models.IntegerField(default=12)),
                ('renouvellement_auto', models.BooleanField(default=False)),
                ('preavis_resiliation_jours', models.IntegerField(default=30)),
                ('date_prochain_renouvellement', models.DateField(blank=True, null=True)),
                ('statut', models.CharField(choices=[('brouillon', 'Brouillon'), ('en_negociation', 'En négociation'), ('actif', 'Actif'), ('suspendu', 'Suspendu'), ('expire', 'Expiré'), ('resilie', 'Résilié')], default='brouillon', max_length=20)),
                ('document_contrat', models.FileField(blank=True, null=True, upload_to='contrats/fournisseurs/')),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('date_modification', models.DateTimeField(auto_now=True)),
                ('cree_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contrats_fournisseurs_crees', to=settings.AUTH_USER_MODEL)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='contrats_fournisseurs', to='core.entreprise')),
                ('fournisseur', models.ForeignKey(limit_choices_to={'type_tiers': 'fournisseur'}, on_delete=django.db.models.deletion.CASCADE, related_name='contrats_fournisseur', to='comptabilite.tiers')),
                ('responsable', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contrats_fournisseurs_responsable', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Contrat fournisseur',
                'verbose_name_plural': 'Contrats fournisseurs',
                'db_table': 'contrats_fournisseur',
                'ordering': ['-date_debut'],
                'unique_together': {('entreprise', 'numero_contrat')},
            },
        ),
        migrations.CreateModel(
            name='ConditionsPaiement',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('mode_paiement', models.CharField(choices=[('comptant', 'Comptant'), ('virement', 'Virement bancaire'), ('cheque', 'Chèque'), ('traite', 'Traite'), ('lettre_change', 'Lettre de change'), ('prelevement', 'Prélèvement'), ('especes', 'Espèces')], max_length=20)),
                ('echeance', models.CharField(choices=[('reception', 'À réception'), ('30_jours', '30 jours'), ('45_jours', '45 jours'), ('60_jours', '60 jours'), ('90_jours', '90 jours'), ('fin_mois', 'Fin de mois'), ('fin_mois_30', 'Fin de mois + 30 jours'), ('personnalise', 'Personnalisé')], max_length=20)),
                ('delai_paiement_jours', models.IntegerField(default=30)),
                ('escompte_paiement_anticipe', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text="Pourcentage d'escompte", max_digits=5)),
                ('delai_escompte_jours', models.IntegerField(default=10)),
                ('acompte_requis', models.BooleanField(default=False)),
                ('pourcentage_acompte', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5)),
                ('paiement_echelonne', models.BooleanField(default=False)),
                ('nombre_echeances', models.IntegerField(default=1)),
                ('conditions_speciales', models.TextField(blank=True, null=True)),
                ('contrat_client', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='conditions_paiement', to='comptabilite.contratclient')),
                ('contrat_fournisseur', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='conditions_paiement', to='comptabilite.contratfournisseur')),
            ],
            options={
                'verbose_name': 'Condition de paiement',
                'verbose_name_plural': 'Conditions de paiement',
                'db_table': 'contrats_conditions_paiement',
            },
        ),
        migrations.CreateModel(
            name='ConditionsLivraison',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('incoterm', models.CharField(blank=True, choices=[('EXW', 'EXW - Ex Works'), ('FCA', 'FCA - Free Carrier'), ('CPT', 'CPT - Carriage Paid To'), ('CIP', 'CIP - Carriage Insurance Paid'), ('DAP', 'DAP - Delivered At Place'), ('DPU', 'DPU - Delivered at Place Unloaded'), ('DDP', 'DDP - Delivered Duty Paid'), ('FAS', 'FAS - Free Alongside Ship'), ('FOB', 'FOB - Free On Board'), ('CFR', 'CFR - Cost and Freight'), ('CIF', 'CIF - Cost Insurance Freight')], max_length=3, null=True)),
                ('lieu_livraison', models.CharField(max_length=200)),
                ('delai_livraison_jours', models.IntegerField(default=0)),
                ('delai_livraison_description', models.CharField(blank=True, max_length=200, null=True)),
                ('mode_transport', models.CharField(blank=True, max_length=50, null=True)),
                ('frais_transport_inclus', models.BooleanField(default=False)),
                ('assurance_incluse', models.BooleanField(default=False)),
                ('conditions_speciales', models.TextField(blank=True, null=True)),
                ('contrat_client', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='conditions_livraison', to='comptabilite.contratclient')),
                ('contrat_fournisseur', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='conditions_livraison', to='comptabilite.contratfournisseur')),
            ],
            options={
                'verbose_name': 'Condition de livraison',
                'verbose_name_plural': 'Conditions de livraison',
                'db_table': 'contrats_conditions_livraison',
            },
        ),
        migrations.CreateModel(
            name='AlerteContrat',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_alerte', models.CharField(choices=[('expiration', 'Expiration proche'), ('renouvellement', 'Renouvellement à prévoir'), ('echeance_paiement', 'Échéance paiement'), ('depassement_budget', 'Dépassement budget'), ('retard_livraison', 'Retard livraison'), ('non_conformite', 'Non-conformité')], max_length=20)),
                ('niveau', models.CharField(choices=[('info', 'Information'), ('warning', 'Avertissement'), ('critical', 'Critique')], default='warning', max_length=10)),
                ('message', models.TextField()),
                ('date_alerte', models.DateTimeField(auto_now_add=True)),
                ('date_echeance', models.DateField(blank=True, null=True)),
                ('statut', models.CharField(choices=[('active', 'Active'), ('acquittee', 'Acquittée'), ('ignoree', 'Ignorée')], default='active', max_length=15)),
                ('date_acquittement', models.DateTimeField(blank=True, null=True)),
                ('acquittee_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='alertes_contrats', to='core.entreprise')),
                ('contrat_client', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='alertes', to='comptabilite.contratclient')),
                ('contrat_fournisseur', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='alertes', to='comptabilite.contratfournisseur')),
            ],
            options={
                'verbose_name': 'Alerte contrat',
                'verbose_name_plural': 'Alertes contrats',
                'db_table': 'contrats_alerte',
                'ordering': ['-date_alerte'],
            },
        ),
        migrations.CreateModel(
            name='FluxDocument',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('numero_etape', models.IntegerField()),
                ('nom_etape', models.CharField(max_length=100)),
                ('description_etape', models.TextField(blank=True, null=True)),
                ('date_debut', models.DateTimeField(blank=True, null=True)),
                ('date_fin', models.DateTimeField(blank=True, null=True)),
                ('delai_prevu_jours', models.IntegerField(default=1)),
                ('statut', models.CharField(choices=[('en_attente', 'En attente'), ('en_cours', 'En cours'), ('termine', 'Terminé'), ('annule', 'Annulé')], default='en_attente', max_length=15)),
                ('commentaire', models.TextField(blank=True, null=True)),
                ('document', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='flux', to='comptabilite.archivedocument')),
                ('responsable', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='etapes_flux_documents', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Flux document',
                'verbose_name_plural': 'Flux documents',
                'db_table': 'archivage_flux_document',
                'ordering': ['document', 'numero_etape'],
            },
        ),
        migrations.CreateModel(
            name='HistoriqueContrat',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_modification', models.CharField(choices=[('creation', 'Création'), ('modification', 'Modification'), ('avenant', 'Avenant'), ('renouvellement', 'Renouvellement'), ('resiliation', 'Résiliation')], max_length=20)),
                ('description', models.TextField()),
                ('champs_modifies', models.JSONField(blank=True, null=True)),
                ('valeurs_avant', models.JSONField(blank=True, null=True)),
                ('valeurs_apres', models.JSONField(blank=True, null=True)),
                ('date_modification', models.DateTimeField(auto_now_add=True)),
                ('contrat_client', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='historique', to='comptabilite.contratclient')),
                ('contrat_fournisseur', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='historique', to='comptabilite.contratfournisseur')),
                ('modifie_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Historique contrat',
                'verbose_name_plural': 'Historiques contrats',
                'db_table': 'contrats_historique',
                'ordering': ['-date_modification'],
            },
        ),
        migrations.CreateModel(
            name='PenaliteRetard',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_penalite', models.CharField(choices=[('retard_paiement', 'Retard de paiement'), ('retard_livraison', 'Retard de livraison'), ('non_conformite', 'Non-conformité'), ('rupture', 'Rupture de contrat')], max_length=20)),
                ('description', models.TextField()),
                ('mode_calcul', models.CharField(choices=[('pourcentage_jour', 'Pourcentage par jour'), ('pourcentage_semaine', 'Pourcentage par semaine'), ('montant_fixe_jour', 'Montant fixe par jour'), ('montant_forfaitaire', 'Montant forfaitaire')], max_length=20)),
                ('taux', models.DecimalField(decimal_places=4, default=Decimal('0.00'), help_text='Taux en pourcentage', max_digits=8)),
                ('montant_fixe', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True)),
                ('plafond_penalite', models.DecimalField(blank=True, decimal_places=2, help_text='Montant maximum de pénalité', max_digits=15, null=True)),
                ('plafond_pourcentage', models.DecimalField(blank=True, decimal_places=2, help_text='Pourcentage max du montant contrat', max_digits=5, null=True)),
                ('jours_franchise', models.IntegerField(default=0, help_text='Jours sans pénalité')),
                ('contrat_client', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='penalites', to='comptabilite.contratclient')),
                ('contrat_fournisseur', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='penalites', to='comptabilite.contratfournisseur')),
            ],
            options={
                'verbose_name': 'Pénalité de retard',
                'verbose_name_plural': 'Pénalités de retard',
                'db_table': 'contrats_penalite_retard',
            },
        ),
        migrations.CreateModel(
            name='PointGaranti',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_garantie', models.CharField(choices=[('qualite', 'Garantie qualité'), ('delai', 'Garantie délai'), ('performance', 'Garantie performance'), ('sav', 'Service après-vente'), ('remplacement', 'Garantie remplacement'), ('remboursement', 'Garantie remboursement')], max_length=20)),
                ('description', models.TextField()),
                ('duree_garantie_mois', models.IntegerField(default=12)),
                ('date_debut_garantie', models.DateField(blank=True, null=True)),
                ('date_fin_garantie', models.DateField(blank=True, null=True)),
                ('conditions_application', models.TextField(blank=True, null=True)),
                ('exclusions', models.TextField(blank=True, null=True)),
                ('montant_garanti', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True)),
                ('contrat_client', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='garanties', to='comptabilite.contratclient')),
                ('contrat_fournisseur', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='garanties', to='comptabilite.contratfournisseur')),
            ],
            options={
                'verbose_name': 'Point garanti',
                'verbose_name_plural': 'Points garantis',
                'db_table': 'contrats_point_garanti',
            },
        ),
        migrations.CreateModel(
            name='PolitiqueRetention',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_document', models.CharField(choices=[('facture_vente', 'Factures de vente'), ('facture_achat', "Factures d'achat"), ('bulletin_paie', 'Bulletins de paie'), ('declaration_fiscale', 'Déclarations fiscales'), ('declaration_sociale', 'Déclarations sociales'), ('contrat', 'Contrats'), ('ecriture_comptable', 'Écritures comptables'), ('releve_bancaire', 'Relevés bancaires'), ('piece_caisse', 'Pièces de caisse'), ('inventaire', 'Inventaires'), ('rapport_audit', "Rapports d'audit"), ('correspondance', 'Correspondances'), ('autre', 'Autre')], max_length=30)),
                ('description', models.TextField(blank=True, null=True)),
                ('duree_conservation_annees', models.IntegerField(default=10)),
                ('base_legale', models.CharField(choices=[('code_commerce', 'Code de Commerce'), ('code_travail', 'Code du Travail'), ('code_fiscal', 'Code Général des Impôts'), ('code_securite_sociale', 'Code Sécurité Sociale'), ('reglementation_interne', 'Réglementation interne')], max_length=30)),
                ('reference_legale', models.CharField(blank=True, help_text='Article de loi ou référence', max_length=200, null=True)),
                ('action_expiration', models.CharField(choices=[('archiver', 'Archiver définitivement'), ('detruire', 'Détruire'), ('reviser', 'Réviser')], default='archiver', max_length=20)),
                ('alerte_avant_expiration_jours', models.IntegerField(default=90)),
                ('est_actif', models.BooleanField(default=True)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('date_modification', models.DateTimeField(auto_now=True)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='politiques_retention', to='core.entreprise')),
            ],
            options={
                'verbose_name': 'Politique de rétention',
                'verbose_name_plural': 'Politiques de rétention',
                'db_table': 'archivage_politique_retention',
                'unique_together': {('entreprise', 'type_document')},
            },
        ),
        migrations.AddField(
            model_name='archivedocument',
            name='politique_retention',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='documents', to='comptabilite.politiqueretention'),
        ),
        migrations.CreateModel(
            name='RapportArchivage',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_rapport', models.CharField(choices=[('inventaire', 'Inventaire documents'), ('retention', 'État rétention'), ('acces', 'Statistiques accès'), ('conformite', 'Conformité archivage'), ('destruction', 'Documents détruits')], max_length=15)),
                ('titre', models.CharField(max_length=200)),
                ('date_debut', models.DateField()),
                ('date_fin', models.DateField()),
                ('resume', models.TextField(blank=True, null=True)),
                ('donnees', models.JSONField(blank=True, null=True)),
                ('fichier_rapport', models.FileField(blank=True, null=True, upload_to='archives/rapports/')),
                ('nombre_documents', models.IntegerField(default=0)),
                ('taille_totale_mo', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('date_generation', models.DateTimeField(auto_now_add=True)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rapports_archivage', to='core.entreprise')),
                ('genere_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Rapport archivage',
                'verbose_name_plural': 'Rapports archivage',
                'db_table': 'archivage_rapport',
                'ordering': ['-date_generation'],
            },
        ),
        migrations.CreateModel(
            name='ReclamationContractuelle',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('numero_reclamation', models.CharField(max_length=50)),
                ('type_reclamation', models.CharField(choices=[('qualite', 'Problème qualité'), ('delai', 'Retard livraison'), ('facturation', 'Erreur facturation'), ('conformite', 'Non-conformité'), ('garantie', 'Litige garantie'), ('autre', 'Autre')], max_length=20)),
                ('priorite', models.CharField(choices=[('basse', 'Basse'), ('normale', 'Normale'), ('haute', 'Haute'), ('urgente', 'Urgente')], default='normale', max_length=10)),
                ('objet', models.CharField(max_length=300)),
                ('description', models.TextField()),
                ('montant_reclame', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('montant_accorde', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True)),
                ('date_reclamation', models.DateField()),
                ('date_limite_reponse', models.DateField(blank=True, null=True)),
                ('date_resolution', models.DateField(blank=True, null=True)),
                ('statut', models.CharField(choices=[('ouverte', 'Ouverte'), ('en_cours', 'En cours de traitement'), ('en_attente', 'En attente réponse'), ('resolue', 'Résolue'), ('rejetee', 'Rejetée'), ('litige', 'En litige')], default='ouverte', max_length=15)),
                ('resolution', models.TextField(blank=True, null=True)),
                ('pieces_jointes', models.FileField(blank=True, null=True, upload_to='contrats/reclamations/')),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('contrat_client', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='reclamations', to='comptabilite.contratclient')),
                ('contrat_fournisseur', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='reclamations', to='comptabilite.contratfournisseur')),
                ('cree_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='reclamations_contractuelles', to='core.entreprise')),
                ('responsable', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reclamations_responsable', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Réclamation contractuelle',
                'verbose_name_plural': 'Réclamations contractuelles',
                'db_table': 'contrats_reclamation',
                'ordering': ['-date_reclamation'],
            },
        ),
        migrations.CreateModel(
            name='SuiviContrat',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_evenement', models.CharField(choices=[('creation', 'Création'), ('modification', 'Modification'), ('renouvellement', 'Renouvellement'), ('suspension', 'Suspension'), ('reprise', 'Reprise'), ('resiliation', 'Résiliation'), ('alerte', 'Alerte'), ('echeance', 'Échéance'), ('facturation', 'Facturation'), ('paiement', 'Paiement'), ('livraison', 'Livraison'), ('reclamation', 'Réclamation')], max_length=20)),
                ('date_evenement', models.DateTimeField()),
                ('description', models.TextField()),
                ('montant', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True)),
                ('conforme', models.BooleanField(default=True)),
                ('ecart_constate', models.TextField(blank=True, null=True)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('contrat_client', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='suivi', to='comptabilite.contratclient')),
                ('contrat_fournisseur', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='suivi', to='comptabilite.contratfournisseur')),
                ('cree_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('facture', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='suivi_contrat', to='comptabilite.facture')),
            ],
            options={
                'verbose_name': 'Suivi contrat',
                'verbose_name_plural': 'Suivis contrats',
                'db_table': 'contrats_suivi',
                'ordering': ['-date_evenement'],
            },
        ),
        migrations.CreateModel(
            name='SuppressionDocument',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_suppression', models.CharField(choices=[('logique', 'Suppression logique'), ('physique', 'Destruction physique'), ('anonymisation', 'Anonymisation')], max_length=15)),
                ('motif', models.TextField()),
                ('reference_legale', models.CharField(blank=True, max_length=200, null=True)),
                ('date_planifiee', models.DateField()),
                ('statut', models.CharField(choices=[('planifiee', 'Planifiée'), ('en_attente_validation', 'En attente validation'), ('validee', 'Validée'), ('executee', 'Exécutée'), ('annulee', 'Annulée')], default='planifiee', max_length=25)),
                ('date_validation', models.DateTimeField(blank=True, null=True)),
                ('date_execution', models.DateTimeField(blank=True, null=True)),
                ('certificat_destruction', models.FileField(blank=True, null=True, upload_to='archives/certificats/')),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('cree_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('document', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='demandes_suppression', to='comptabilite.archivedocument')),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='suppressions_documents', to='core.entreprise')),
                ('executee_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='suppressions_executees', to=settings.AUTH_USER_MODEL)),
                ('validee_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='suppressions_validees', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Suppression document',
                'verbose_name_plural': 'Suppressions documents',
                'db_table': 'archivage_suppression',
                'ordering': ['-date_planifiee'],
            },
        ),
        migrations.CreateModel(
            name='TraceAccesDocument',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_acces', models.CharField(choices=[('consultation', 'Consultation'), ('telechargement', 'Téléchargement'), ('impression', 'Impression'), ('modification', 'Modification'), ('suppression', 'Suppression')], max_length=15)),
                ('date_acces', models.DateTimeField(auto_now_add=True)),
                ('adresse_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.CharField(blank=True, max_length=500, null=True)),
                ('succes', models.BooleanField(default=True)),
                ('motif_echec', models.CharField(blank=True, max_length=200, null=True)),
                ('document', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='traces_acces', to='comptabilite.archivedocument')),
                ('utilisateur', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Trace accès document',
                'verbose_name_plural': 'Traces accès documents',
                'db_table': 'archivage_trace_acces',
                'ordering': ['-date_acces'],
            },
        ),
        migrations.CreateModel(
            name='ValidationDocument',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('niveau_validation', models.IntegerField(default=1)),
                ('statut', models.CharField(choices=[('en_attente', 'En attente'), ('valide', 'Validé'), ('rejete', 'Rejeté'), ('a_completer', 'À compléter')], default='en_attente', max_length=15)),
                ('date_validation', models.DateTimeField(blank=True, null=True)),
                ('commentaire', models.TextField(blank=True, null=True)),
                ('motif_rejet', models.TextField(blank=True, null=True)),
                ('document', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='validations', to='comptabilite.archivedocument')),
                ('validateur', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='validations_documents', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Validation document',
                'verbose_name_plural': 'Validations documents',
                'db_table': 'archivage_validation',
                'ordering': ['niveau_validation'],
            },
        ),
        migrations.CreateModel(
            name='VerificationSignature',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_signature', models.CharField(choices=[('manuscrite', 'Signature manuscrite'), ('electronique', 'Signature électronique'), ('cachet', 'Cachet/Tampon')], max_length=15)),
                ('signataire_attendu', models.CharField(max_length=200)),
                ('fonction_signataire', models.CharField(blank=True, max_length=100, null=True)),
                ('statut', models.CharField(choices=[('a_verifier', 'À vérifier'), ('valide', 'Valide'), ('invalide', 'Invalide'), ('non_applicable', 'Non applicable')], default='a_verifier', max_length=15)),
                ('date_verification', models.DateTimeField(blank=True, null=True)),
                ('observations', models.TextField(blank=True, null=True)),
                ('document', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='verifications_signature', to='comptabilite.archivedocument')),
                ('verifie_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Vérification signature',
                'verbose_name_plural': 'Vérifications signatures',
                'db_table': 'archivage_verification_signature',
            },
        ),
        migrations.CreateModel(
            name='MatricePiecesJustificatives',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_operation', models.CharField(choices=[('achat', 'Achat'), ('vente', 'Vente'), ('encaissement', 'Encaissement'), ('decaissement', 'Décaissement'), ('paie', 'Paie'), ('immobilisation', 'Immobilisation'), ('stock', 'Stock'), ('od', 'Opération diverse')], max_length=20)),
                ('description', models.TextField(blank=True, null=True)),
                ('pieces_obligatoires', models.JSONField(default=list, help_text='Liste des pièces obligatoires')),
                ('pieces_optionnelles', models.JSONField(default=list, help_text='Liste des pièces optionnelles')),
                ('seuil_montant', models.DecimalField(blank=True, decimal_places=2, help_text='Seuil au-delà duquel pièces supplémentaires requises', max_digits=15, null=True)),
                ('pieces_supplementaires_seuil', models.JSONField(default=list)),
                ('validation_requise', models.BooleanField(default=True)),
                ('niveaux_validation', models.IntegerField(default=1)),
                ('est_actif', models.BooleanField(default=True)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('date_modification', models.DateTimeField(auto_now=True)),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='matrices_pieces', to='core.entreprise')),
            ],
            options={
                'verbose_name': 'Matrice pièces justificatives',
                'verbose_name_plural': 'Matrices pièces justificatives',
                'db_table': 'archivage_matrice_pieces',
                'unique_together': {('entreprise', 'type_operation')},
            },
        ),
        migrations.AddIndex(
            model_name='archivedocument',
            index=models.Index(fields=['entreprise', 'statut'], name='archivage_d_entrepr_8e8bb8_idx'),
        ),
        migrations.AddIndex(
            model_name='archivedocument',
            index=models.Index(fields=['date_expiration'], name='archivage_d_date_ex_d0bb30_idx'),
        ),
        migrations.AddIndex(
            model_name='archivedocument',
            index=models.Index(fields=['reference'], name='archivage_d_referen_6f601f_idx'),
        ),
        migrations.AddIndex(
            model_name='traceaccesdocument',
            index=models.Index(fields=['document', 'date_acces'], name='archivage_t_documen_f09ab1_idx'),
        ),
        migrations.AddIndex(
            model_name='traceaccesdocument',
            index=models.Index(fields=['utilisateur', 'date_acces'], name='archivage_t_utilisa_5757de_idx'),
        ),
    ]
