# Generated by Django 5.2.7 on 2026-01-29 13:48

import django.core.validators
import django.db.models.deletion
import uuid
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('comptabilite', '0006_tresorerie_avancee'),
        ('core', '0011_add_expatrie_fields'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='AffectationResultat',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('resultat_exercice', models.DecimalField(decimal_places=2, max_digits=15)),
                ('report_anterieur', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('montant_a_affecter', models.DecimalField(decimal_places=2, max_digits=15)),
                ('type_affectation', models.CharField(choices=[('reserve_legale', 'Réserve légale'), ('reserve_statutaire', 'Réserve statutaire'), ('reserve_facultative', 'Réserve facultative'), ('report_nouveau', 'Report à nouveau'), ('dividende', 'Dividendes'), ('participation', 'Participation salariés'), ('autre', 'Autre affectation')], max_length=20)),
                ('montant_affecte', models.DecimalField(decimal_places=2, max_digits=15)),
                ('montant_par_action', models.DecimalField(blank=True, decimal_places=4, max_digits=10, null=True)),
                ('date_mise_paiement', models.DateField(blank=True, null=True)),
                ('statut', models.CharField(choices=[('proposition', 'Proposition'), ('approuve', 'Approuvé AG'), ('comptabilise', 'Comptabilisé'), ('distribue', 'Distribué')], default='proposition', max_length=20)),
                ('date_ag', models.DateField(blank=True, null=True, verbose_name='Date AG')),
                ('numero_resolution', models.CharField(blank=True, max_length=50, null=True)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('cree_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('ecriture', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='comptabilite.ecriturecomptable')),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='affectations_resultat', to='core.entreprise')),
                ('exercice', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='affectations_resultat', to='comptabilite.exercicecomptable')),
            ],
            options={
                'verbose_name': 'Affectation du résultat',
                'verbose_name_plural': 'Affectations du résultat',
                'db_table': 'consolidation_affectation_resultat',
                'ordering': ['-exercice__date_fin'],
            },
        ),
        migrations.CreateModel(
            name='ConsolidationFiliales',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('reference', models.CharField(max_length=50, verbose_name='Référence consolidation')),
                ('libelle', models.CharField(max_length=200)),
                ('date_consolidation', models.DateField()),
                ('date_debut_periode', models.DateField()),
                ('date_fin_periode', models.DateField()),
                ('methode_consolidation', models.CharField(choices=[('integration_globale', 'Intégration globale (IG)'), ('integration_proportionnelle', 'Intégration proportionnelle (IP)'), ('mise_equivalence', 'Mise en équivalence (MEE)')], default='integration_globale', max_length=30)),
                ('statut', models.CharField(choices=[('brouillon', 'Brouillon'), ('en_cours', 'En cours'), ('valide', 'Validé'), ('cloture', 'Clôturé'), ('annule', 'Annulé')], default='brouillon', max_length=20)),
                ('date_validation', models.DateTimeField(blank=True, null=True)),
                ('notes', models.TextField(blank=True, null=True)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('date_modification', models.DateTimeField(auto_now=True)),
                ('cree_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='consolidations_creees', to=settings.AUTH_USER_MODEL)),
                ('devise_consolidation', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.devise')),
                ('entreprise_mere', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='consolidations_groupe', to='core.entreprise')),
                ('exercice', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='consolidations_filiales', to='comptabilite.exercicecomptable')),
                ('valide_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='consolidations_validees', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Consolidation filiales',
                'verbose_name_plural': 'Consolidations filiales',
                'db_table': 'consolidation_filiales',
                'ordering': ['-date_consolidation'],
                'unique_together': {('entreprise_mere', 'exercice', 'reference')},
            },
        ),
        migrations.CreateModel(
            name='CompteResultatConsolide',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('date_debut', models.DateField()),
                ('date_fin', models.DateField()),
                ('chiffre_affaires', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('autres_produits_exploitation', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_produits_exploitation', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('achats_consommes', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('charges_personnel', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('dotations_amortissements', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('dotations_provisions', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('autres_charges_exploitation', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_charges_exploitation', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('resultat_exploitation', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('produits_financiers', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('charges_financieres', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('resultat_financier', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('resultat_courant', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('produits_exceptionnels', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('charges_exceptionnelles', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('resultat_exceptionnel', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('impots_sur_benefices', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('impots_differes', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('quote_part_mee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15, verbose_name='Quote-part résultat MEE')),
                ('resultat_net_ensemble', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('resultat_minoritaires', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('resultat_net_groupe', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('resultat_par_action', models.DecimalField(blank=True, decimal_places=4, max_digits=10, null=True)),
                ('resultat_dilue_par_action', models.DecimalField(blank=True, decimal_places=4, max_digits=10, null=True)),
                ('est_valide', models.BooleanField(default=False)),
                ('date_validation', models.DateTimeField(blank=True, null=True)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('date_modification', models.DateTimeField(auto_now=True)),
                ('valide_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('consolidation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='comptes_resultat', to='comptabilite.consolidationfiliales')),
            ],
            options={
                'verbose_name': 'Compte de résultat consolidé',
                'verbose_name_plural': 'Comptes de résultat consolidés',
                'db_table': 'consolidation_compte_resultat',
                'ordering': ['-date_fin'],
            },
        ),
        migrations.CreateModel(
            name='BilanConsolide',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('date_bilan', models.DateField()),
                ('immobilisations_incorporelles', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('goodwill', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('immobilisations_corporelles', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('immobilisations_financieres', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('participations_mee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15, verbose_name='Participations MEE')),
                ('actifs_impots_differes', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_actif_immobilise', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('stocks', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('creances_clients', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('autres_creances', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('tresorerie_actif', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_actif_circulant', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_actif', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('capital_social', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('primes', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('reserves_consolidees', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('ecarts_conversion', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('resultat_groupe', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('capitaux_propres_groupe', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('interets_minoritaires', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_capitaux_propres', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('provisions', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('emprunts_lt', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15, verbose_name='Emprunts long terme')),
                ('passifs_impots_differes', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_passif_non_courant', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('dettes_fournisseurs', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('autres_dettes', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('emprunts_ct', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15, verbose_name='Emprunts court terme')),
                ('tresorerie_passif', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_passif_courant', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_passif', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('est_valide', models.BooleanField(default=False)),
                ('date_validation', models.DateTimeField(blank=True, null=True)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('date_modification', models.DateTimeField(auto_now=True)),
                ('valide_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('consolidation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='bilans', to='comptabilite.consolidationfiliales')),
            ],
            options={
                'verbose_name': 'Bilan consolidé',
                'verbose_name_plural': 'Bilans consolidés',
                'db_table': 'consolidation_bilan',
                'ordering': ['-date_bilan'],
            },
        ),
        migrations.CreateModel(
            name='AjustementConsolidation',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_ajustement', models.CharField(choices=[('retraitement', "Retraitement d'homogénéité"), ('conversion', 'Écart de conversion'), ('impot_differe', 'Impôts différés'), ('goodwill', 'Amortissement goodwill'), ('minoritaires', 'Intérêts minoritaires'), ('autre', 'Autre ajustement')], max_length=20)),
                ('montant_debit', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('montant_credit', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('libelle', models.CharField(max_length=200)),
                ('justification', models.TextField(blank=True, null=True)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('compte_credit', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='ajustements_credit', to='comptabilite.plancomptable')),
                ('compte_debit', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='ajustements_debit', to='comptabilite.plancomptable')),
                ('cree_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('ecriture', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='comptabilite.ecriturecomptable')),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.entreprise')),
                ('consolidation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ajustements', to='comptabilite.consolidationfiliales')),
            ],
            options={
                'verbose_name': 'Ajustement de consolidation',
                'verbose_name_plural': 'Ajustements de consolidation',
                'db_table': 'consolidation_ajustement',
            },
        ),
        migrations.CreateModel(
            name='DocumentationConsolidation',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_document', models.CharField(choices=[('procedure', 'Procédure'), ('checklist', 'Checklist'), ('rapport', 'Rapport'), ('justificatif', 'Justificatif'), ('correspondance', 'Correspondance'), ('autre', 'Autre')], max_length=20)),
                ('titre', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True, null=True)),
                ('fichier', models.FileField(upload_to='consolidation/documentation/')),
                ('version', models.CharField(default='1.0', max_length=20)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('consolidation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documentation', to='comptabilite.consolidationfiliales')),
                ('cree_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Documentation consolidation',
                'verbose_name_plural': 'Documentation consolidation',
                'db_table': 'consolidation_documentation',
                'ordering': ['-date_creation'],
            },
        ),
        migrations.CreateModel(
            name='EliminationIGF',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_elimination', models.CharField(choices=[('creance_dette', 'Créances/Dettes réciproques'), ('produit_charge', 'Produits/Charges réciproques'), ('dividende', 'Dividendes intra-groupe'), ('marge_stock', 'Marges sur stocks'), ('plus_value', 'Plus-values sur cessions internes'), ('provision', 'Provisions intra-groupe'), ('capital', 'Titres de participation/Capital')], max_length=20)),
                ('montant_brut', models.DecimalField(decimal_places=2, max_digits=15)),
                ('montant_elimine', models.DecimalField(decimal_places=2, max_digits=15)),
                ('statut', models.CharField(choices=[('identifie', 'Identifié'), ('valide', 'Validé'), ('comptabilise', 'Comptabilisé'), ('annule', 'Annulé')], default='identifie', max_length=20)),
                ('libelle', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True, null=True)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('date_validation', models.DateTimeField(blank=True, null=True)),
                ('compte_credit', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='eliminations_credit', to='comptabilite.plancomptable')),
                ('compte_debit', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='eliminations_debit', to='comptabilite.plancomptable')),
                ('consolidation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='eliminations', to='comptabilite.consolidationfiliales')),
                ('ecriture_consolidation', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='comptabilite.ecriturecomptable')),
                ('entreprise_destination', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='eliminations_destination', to='core.entreprise')),
                ('entreprise_source', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='eliminations_source', to='core.entreprise')),
                ('valide_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Élimination IGF',
                'verbose_name_plural': 'Éliminations IGF',
                'db_table': 'consolidation_elimination_igf',
                'ordering': ['-date_creation'],
            },
        ),
        migrations.CreateModel(
            name='FluxTresorerieConsolide',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('date_debut', models.DateField()),
                ('date_fin', models.DateField()),
                ('resultat_net', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('amortissements_provisions', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('variation_bfr', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15, verbose_name='Variation BFR')),
                ('autres_flux_exploitation', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('flux_exploitation', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('acquisitions_immobilisations', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('cessions_immobilisations', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('acquisitions_filiales', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('cessions_filiales', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('autres_flux_investissement', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('flux_investissement', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('augmentation_capital', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('dividendes_verses', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('emprunts_nouveaux', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('remboursements_emprunts', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('autres_flux_financement', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('flux_financement', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('variation_tresorerie', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('effet_change', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('tresorerie_ouverture', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('tresorerie_cloture', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('est_valide', models.BooleanField(default=False)),
                ('date_validation', models.DateTimeField(blank=True, null=True)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('date_modification', models.DateTimeField(auto_now=True)),
                ('consolidation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='flux_tresorerie', to='comptabilite.consolidationfiliales')),
                ('valide_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Flux de trésorerie consolidé',
                'verbose_name_plural': 'Flux de trésorerie consolidés',
                'db_table': 'consolidation_flux_tresorerie',
                'ordering': ['-date_fin'],
            },
        ),
        migrations.CreateModel(
            name='MatriceConsolidation',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('pourcentage_capital', models.DecimalField(decimal_places=2, max_digits=6, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='% du capital')),
                ('pourcentage_droits_vote', models.DecimalField(decimal_places=2, max_digits=6, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='% droits de vote')),
                ('pourcentage_interet', models.DecimalField(decimal_places=2, max_digits=6, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name="% d'intérêt")),
                ('type_controle', models.CharField(choices=[('filiale', 'Filiale (contrôle exclusif >50%)'), ('participation', 'Participation (influence notable 20-50%)'), ('minoritaire', 'Participation minoritaire (<20%)'), ('conjointe', 'Entreprise conjointe (contrôle conjoint)')], max_length=20)),
                ('date_acquisition', models.DateField(verbose_name="Date d'acquisition")),
                ('date_fin', models.DateField(blank=True, null=True, verbose_name='Date de cession')),
                ('cout_acquisition', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('goodwill', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text="Écart d'acquisition (survaleur)", max_digits=15)),
                ('badwill', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text="Écart d'acquisition négatif", max_digits=15)),
                ('est_active', models.BooleanField(default=True)),
                ('notes', models.TextField(blank=True, null=True)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('date_modification', models.DateTimeField(auto_now=True)),
                ('cree_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('devise', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='core.devise')),
                ('entreprise_fille', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='participations_recues', to='core.entreprise')),
                ('entreprise_mere', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='participations_detenues', to='core.entreprise')),
            ],
            options={
                'verbose_name': 'Matrice de consolidation',
                'verbose_name_plural': 'Matrices de consolidation',
                'db_table': 'consolidation_matrice',
                'ordering': ['-pourcentage_capital'],
                'unique_together': {('entreprise_mere', 'entreprise_fille')},
            },
        ),
        migrations.CreateModel(
            name='VariationCapitaux',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type_variation', models.CharField(choices=[('capital_initial', 'Capital initial'), ('augmentation_capital', 'Augmentation de capital'), ('reduction_capital', 'Réduction de capital'), ('resultat_exercice', "Résultat de l'exercice"), ('affectation_resultat', 'Affectation du résultat'), ('distribution_dividendes', 'Distribution de dividendes'), ('ecart_reevaluation', 'Écart de réévaluation'), ('ecart_conversion', 'Écart de conversion'), ('variation_perimetre', 'Variation de périmètre'), ('autres_variations', 'Autres variations')], max_length=30)),
                ('capital_social', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('primes_emission', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('reserves', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('report_nouveau', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('resultat_exercice', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('ecarts_reevaluation', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('ecarts_conversion', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('interets_minoritaires', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_capitaux_propres', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('libelle', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True, null=True)),
                ('date_variation', models.DateField()),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('consolidation', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='variations_capitaux', to='comptabilite.consolidationfiliales')),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='variations_capitaux', to='core.entreprise')),
                ('exercice', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='variations_capitaux', to='comptabilite.exercicecomptable')),
            ],
            options={
                'verbose_name': 'Variation des capitaux',
                'verbose_name_plural': 'Variations des capitaux',
                'db_table': 'consolidation_variation_capitaux',
                'ordering': ['exercice', 'date_variation'],
            },
        ),
        migrations.CreateModel(
            name='NoteExplicative',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('numero_note', models.CharField(max_length=10, verbose_name='N° Note')),
                ('titre', models.CharField(max_length=200)),
                ('categorie', models.CharField(choices=[('principes', 'Principes comptables'), ('perimetre', 'Périmètre de consolidation'), ('methodes', 'Méthodes de consolidation'), ('immobilisations', 'Immobilisations'), ('stocks', 'Stocks'), ('creances', 'Créances'), ('tresorerie', 'Trésorerie'), ('capitaux', 'Capitaux propres'), ('provisions', 'Provisions'), ('dettes', 'Dettes'), ('engagements', 'Engagements hors bilan'), ('parties_liees', 'Parties liées'), ('evenements', 'Événements postérieurs'), ('risques', 'Gestion des risques'), ('autre', 'Autre')], max_length=20)),
                ('contenu', models.TextField(verbose_name='Contenu de la note')),
                ('tableaux_json', models.JSONField(blank=True, help_text='Tableaux de données en JSON', null=True)),
                ('ordre', models.IntegerField(default=0)),
                ('est_publie', models.BooleanField(default=False)),
                ('date_creation', models.DateTimeField(auto_now_add=True)),
                ('date_modification', models.DateTimeField(auto_now=True)),
                ('consolidation', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='notes_explicatives', to='comptabilite.consolidationfiliales')),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notes_explicatives', to='core.entreprise')),
                ('exercice', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notes_explicatives', to='comptabilite.exercicecomptable')),
                ('redige_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='notes_redigees', to=settings.AUTH_USER_MODEL)),
                ('valide_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='notes_validees', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Note explicative',
                'verbose_name_plural': 'Notes explicatives',
                'db_table': 'consolidation_note_explicative',
                'ordering': ['exercice', 'ordre', 'numero_note'],
                'unique_together': {('entreprise', 'exercice', 'numero_note')},
            },
        ),
        migrations.CreateModel(
            name='PerimetreConsolidation',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('methode', models.CharField(choices=[('integration_globale', 'Intégration globale (IG)'), ('integration_proportionnelle', 'Intégration proportionnelle (IP)'), ('mise_equivalence', 'Mise en équivalence (MEE)')], max_length=30)),
                ('pourcentage_integration', models.DecimalField(decimal_places=2, max_digits=6, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('pourcentage_interet', models.DecimalField(decimal_places=2, max_digits=6, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('taux_change_cloture', models.DecimalField(decimal_places=4, default=Decimal('1.0000'), max_digits=10)),
                ('taux_change_moyen', models.DecimalField(decimal_places=4, default=Decimal('1.0000'), max_digits=10)),
                ('est_incluse', models.BooleanField(default=True)),
                ('motif_exclusion', models.TextField(blank=True, null=True)),
                ('consolidation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='perimetre', to='comptabilite.consolidationfiliales')),
                ('entreprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.entreprise')),
                ('matrice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='comptabilite.matriceconsolidation')),
            ],
            options={
                'verbose_name': 'Périmètre de consolidation',
                'verbose_name_plural': 'Périmètres de consolidation',
                'db_table': 'consolidation_perimetre',
                'unique_together': {('consolidation', 'entreprise')},
            },
        ),
    ]
